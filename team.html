<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Team Picker</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        .teams {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-bottom: 30px;
        }
        .team {
            display: flex;
            flex-direction: row;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .player-list {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .player-list img, .slot img {
            width: 100px;
            height: 100px;
            margin: 10px;
            cursor: pointer;
        }
        .slot {
            border: 2px dashed #999;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .selected {
            border: 3px solid #4CAF50;
        }
        .clear-buttons {
            margin-top: 20px;
        }
    </style>
    <script type="module">
        import { players } from './players.js';

        window.addEventListener('DOMContentLoaded', () => {
            const playerList = document.getElementById('player-list');
            let selectedPlayer = null;
            let selectedImg = null;

            players.sort((a, b) => a.number - b.number);

            // Create player list with unique data-id for each image
            players.forEach(player => {
                const img = document.createElement('img');
                img.src = player.image;
                img.alt = player.name;
                img.title = player.description;
                img.dataset.id = player.id;  // Add unique player ID
                img.addEventListener('click', () => {
                    if (selectedImg) {
                        selectedImg.classList.remove('selected');
                    }
                    if (selectedPlayer === player) {
                        selectedPlayer = null;
                        selectedImg = null;
                    } else {
                        selectedPlayer = player;
                        img.classList.add('selected');
                        selectedImg = img;
                    }
                });
                playerList.appendChild(img);
            });

            // Allow placing player images into slots
            document.querySelectorAll('.slot').forEach(slot => {
                slot.addEventListener('click', () => {
                    if (selectedPlayer) {
                        slot.innerHTML = `<img src="${selectedPlayer.image}" 
                            alt="${selectedPlayer.name}" 
                            title="${selectedPlayer.description}" 
                            data-id="${selectedPlayer.id}">`;
                        selectedPlayer = null;
                        if (selectedImg) {
                            selectedImg.classList.remove('selected');
                            selectedImg = null;
                        }
                        if (document.getElementById('unique-player').checked) {
                            enforceUniquePlayers();
                        }
                    }
                });
            });

            // Clear team slots
            document.getElementById('clear-team1').addEventListener('click', () => {
                clearTeamSlots('team1');
            });

            document.getElementById('clear-team2').addEventListener('click', () => {
                clearTeamSlots('team2');
            });

            // Randomize teams
            document.getElementById('randomize-team1').addEventListener('click', () => {
                randomizeTeamSlots('team1');
            });

            document.getElementById('randomize-team2').addEventListener('click', () => {
                randomizeTeamSlots('team2');
            });

            // Ensure unique player selection by hiding used players
            function enforceUniquePlayers() {
                const selectedIds = new Set();
                
                // Collect the src of images already in slots
                document.querySelectorAll('.slot img').forEach(img => {
                    selectedIds.add(img.src);
                });

                // Hide images that match the selected src
                document.querySelectorAll('#player-list img').forEach(img => {
                    if (selectedIds.has(img.src)) {
                        img.style.visibility = 'hidden';
                    } else {
                        img.style.visibility = 'visible';
                    }
                });
            }


            // Clear specific team slots
            function clearTeamSlots(team) {
                document.querySelectorAll(`[data-slot^="${team}"]`).forEach(slot => {
                    slot.innerHTML = slot.getAttribute('data-slot').split('-')[1];
                });
                enforceUniquePlayers();
            }

            // Randomize team slots with shuffled players
            function randomizeTeamSlots(team) {
                const teamSlots = document.querySelectorAll(`[data-slot^="${team}"]`);
                const shuffledPlayers = [...players].sort(() => 0.5 - Math.random());

                let availablePlayers = shuffledPlayers.filter(player => {
                    return !Array.from(document.querySelectorAll('.slot img')).some(img => img.dataset.id == player.id);
                });

                teamSlots.forEach(slot => {
                    // Check if the slot already has a player
                    if (!slot.querySelector('img')) {
                        const player = availablePlayers.shift();
                        if (player) {
                            slot.innerHTML = `<img src="${player.image}" 
                                alt="${player.name}" 
                                title="${player.description}" 
                                data-id="${player.id}">`;
                        }
                    }
                });
                enforceUniquePlayers();
            }

        });
    </script>
</head>
<body>
    <h1>Basketball Team Picker</h1>
    
    <div class="container">
        <label>
            <input type="checkbox" id="unique-player" checked> Enforce Unique Players per Team
        </label>
        <div class="teams">
            <div class="team">
                <h2>Team 1</h2>
                <div class="slot" data-slot="team1-PG">PG</div>
                <div class="slot" data-slot="team1-SG">SG</div>
                <div class="slot" data-slot="team1-SF">SF</div>
                <div class="slot" data-slot="team1-PF">PF</div>
                <div class="slot" data-slot="team1-C">C</div>
            </div>
            <div class="team">
                <h2>Team 2</h2>
                <div class="slot" data-slot="team2-PG">PG</div>
                <div class="slot" data-slot="team2-SG">SG</div>
                <div class="slot" data-slot="team2-SF">SF</div>
                <div class="slot" data-slot="team2-PF">PF</div>
                <div class="slot" data-slot="team2-C">C</div>
            </div>
        </div>

        <div class="clear-buttons">
            <button id="clear-team1">Clear Team 1</button>
            <button id="clear-team2">Clear Team 2</button>
            <button id="randomize-team1">Randomize Team 1</button>
            <button id="randomize-team2">Randomize Team 2</button>
        </div>

        <div class="players">
            <h2>Players</h2>
            <div class="player-list" id="player-list"></div>
        </div>
    </div>
</body>
</html>
